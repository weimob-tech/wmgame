var wmGame=wmGame||{};(function(e){e.init=function(e,n,i){var t;var a=new r(e,i,function(e){t=e});n(a,t)};function r(e,n,i){var t=n;var d=this;var o=0;var T=60;var y;var w;var _;this.create=function(e){if(!Array.isArray(e)){console.log("create传入数据必须是数组");return false}var s=new P.contain;s.mcs={};function o(e,n){for(var i=n.length-1;i>=0;i--){var t=n[i];if(Array.isArray(t)){var a=new P.contain;e.addChild(a);o(a,t)}else if(l(t)){if(!c(t))return false;else{if(t.t=="s"){var r=d.createShape(t.v)}else if(t.t=="i"){r=d.creatImg(t.v)}else if(t.t=="t"){r=d.createTxt(t.v)}if(t.t!="c"){if(t.s!=undefined){var f=t.s;if(f.x!=undefined)r.x=f.x;if(f.y!=undefined)r.y=f.y;if(f.a!=undefined)r.alpha=f.a;if(f.sx!=undefined)r.scaleX=f.sx;if(f.sy!=undefined)r.scaleY=f.sy;if(f.r!=undefined)r.rotate=f.r}e.addChild(r);if(t.z!=undefined){s.mcs[t.z]=r}}else{if(t.s!=undefined){var f=t.s;if(f.x!=undefined)e.x=f.x;if(f.y!=undefined)e.y=f.y;if(f.a!=undefined)e.alpha=f.a;if(f.sx!=undefined)e.scaleX=f.sx;if(f.sy!=undefined)e.scaleY=f.sy;if(f.r!=undefined)e.rotate=f.r}s.mcs[t.z]=e}}}else{return false}}}o(s,e);function c(e){if(e&&e.t!="s"&&e.t!="i"&&e.t!="t"&&e.t!="c"){console.log(e,"对象的t是无效变量");return false}if(e.s==undefined||e.s==null){e.s={}}return true}return s};this.contain=function(){return new P.contain};this.creatImg=function(e){if(!l(e)){console.log(e,"图片创建参数必须是对象");return}if(typeof e.s==="string"){var n=wx.createImage();n.src=e.s}else{n=e.s}return new P.createImage(n,e.x,e.y)};this.createShape=function(e){if(!l(e)){console.log(e,"图形创建参数必须是对象");return}e.d.width=e.d.w;e.d.height=e.d.h;e.d.color=e.d.c;return new P.createShape(e.t,e.d)};this.createTxt=function(e){if(!l(e)){console.log(e,"文本创建参数必须是对象");return}if(e.t==undefined)e.t=" ";return new P.createTxt(e.t,e.s+" "+e.ty,e.c,"left",e.x,e.y)};this.update=function(e){if(e==undefined){P.openRepick(undefined,false)}else if(e=="loop"){P.openRepick()}else if(e=="stop"){P.opening=false;P.removeTime()}};this.addAct=function(e,n,i,...t){var a;var r;var f;for(var s=0;s<t.length;s++){if(a==undefined&&typeof t[s]=="function"&&s==0){a=t[s]}else if(f==undefined&&typeof t[s]=="boolean"&&s<=1){f=t[s]}else if(f==undefined&&typeof t[s]=="boolean"&&s<=2&&s>0){r=t[s]}}o++;P.tweenCreate("m"+o,e,n,i,r,f,a);return"m"+o};this.removeAct=function(e){P.tweenRemove(e)};this.setFps=function(e){if(e!=T){T=e;if(P._time!=undefined){P.removeTime();var n=P.repickFun;P.openRepick(undefined,P.opening,P.noClear)}}else{T=e}};this.on=function(e,n){if(e=="tick"){if(w==undefined)w=[];w.push(n)}else if(e=="tickDown"){if(_==undefined)_=[];_.push(n)}};this.off=function(e,n){if(e=="tick"){if(n==undefined)w=undefined;else{if(w!=undefined){for(var i=0;i<w.length;i++){if(w[i]==n){w.splice(i,1);return}}}}}else if(e=="tickDown"){if(n==undefined)_=undefined;else{if(_!=undefined){for(var i=0;i<_.length;i++){if(_[i]==n){_.splice(i,1);return}}}}}};function l(e){return e!==null&&!Array.isArray(e)&&typeof e==="object"}function h(e,n,i,t,a){e._eventType=t;e._eventSX=a;var r={mc:e,type:n,fun:i};v.push(r)}function u(e,n){for(var i=0;i<v.length;i++){if(v[i].mc==e&&v[i].type==n){v.splice(i,1)}}}function S(e,n,i){var t=e.length,a=t,r=0;for(var f=0;f<t;f++){if(e.charCodeAt(f)>128){if(r+2<=n){r+=2}else{a=f;break}}else{if(r+1<=n){r+=1}else{a=f;break}}}if(i==-1)return e.substr(0,a)+"...";else if(t==a)return e;else if(i==1)return e.substr(0,a);else if(i==0)return e.substr(0,a)+"..."}function c(e,n,i,t){var a=e.length;var r=0;var f=0;var s="";for(var o=0;o<a;o++){if(t!=undefined)n.font=t;var c=n.measureText(e[o]).width;r+=c;if(r>=i){if(o!=a-1)s=s+e.slice(f,o+1)+"\n";else s=s+e.slice(f,o+1);f=o+1;r=0}}s=s+e.slice(f);return s}function a(){P.inite(wx.createCanvas());P.canvas.realWidth=P.canvas.width;P.canvas.realHeight=P.canvas.height;var e=t.width/P.canvas.width;P.canvas.width*=e;P.canvas.height*=e;d.stage=P.stage;i(P.canvas)}var v=[];var I=[];var P={inite:function(e,n,i){var t,a;a=e;t=a.getContext("2d",{antialias:true});t.scale(1,1);P.ctx=t;P.canvas=a;P.stage=new P.contain;if(P.fps==undefined)P.fps=60;if(requestAnimationFrame==undefined){a.timesp=-1;requestAnimationFrame=function(e){a.timesp=setTimeout(function(){e();requestAnimationFrame(e)},1e3/60)}}wx.onTouchStart(r);wx.onTouchMove(r);wx.onTouchEnd(r);wx.onTouchCancel(r);function r(e){P.events(e)}P.remove=function(){wx.offTouchStart(r);wx.offTouchMove(r);wx.offTouchEnd(r);wx.offTouchCancel(r)}},createImage:function(e,n,i,t,a,r,f){var s=this;s.type="img";s.img=e;s.x=n!=undefined?n:0;s.y=i!=undefined?i:0;s.regX=t!=undefined?t:0;s.regY=a!=undefined?a:0;s.scaleX=r!=undefined?r:1;s.scaleY=f!=undefined?f:1;s.rotate=0;s.alpha=1;s.on=function(e,n,i,t){h(s,e,n,i,t)};s.off=function(e,n){u(s,e,n)}},createImage2:function(e,n,i,t,a){if(a==undefined){a=t/e.width;t=a}else if(t==undefined){a=a/e.height;t=a}else{t=t/e.width;a=a/e.height}let r=new P.createImage(e,n,i,e.width/2,e.height/2,t,a);return r},createTxt:function(e,n,i,t,a,r,f,s){var o=this;o.type="txt";o.text=e!=undefined?e:"".toString();o.size=n!=undefined?n:"20px Microsoft Yahei";o.color=i!=undefined?i:"#ffffff";o.align=t!=undefined?t:"center";o.x=a!=undefined?a:0;o.y=r!=undefined?r:0;o.maxWith=f;o.maxHeight=s;o.alpha=1;var c=P.ctx;c.font=o.size;o.text=o.text.toString();var d=o.text.split("\n");if(d.length==1)o.width=c.measureText(o.text).width;else{for(var l=0;l<d.length;l++){if(l==0)o.width=c.measureText(d[l]).width;else if(o.width<c.measureText(d[l]).width)o.width=c.measureText(d[l]).width}}o.on=function(e,n,i,t){h(o,e,n,i,t)};o.off=function(e,n){u(o,e,n)}},createTxt2:function(e,n,i,t,a,r,f){return new P.createTxt(e,n.size,n.color,i,t,a,r,f)},createShape:function(e,n){var a=this;a.type="shape";if(n.scx!=undefined)a.scx=n.scx;else a.scx=1;if(n.scy!=undefined)a.scy=n.scy;else a.scy=1;if(e==1){a.width=n.width;a.height=n.height}else if(e==2){a.r=n.r}else if(e==3){a.width=n.width;a.height=n.height;a.r=n.r}else if(e==4){a.points=n.points}else if(e==-1){a.drawOther=n.drawOther}a.x=n.x||0;a.y=n.y||0;a.color=n.color;a.typeSp=e;a.alpha=1;a.on=function(e,n,i,t){h(a,e,n,i,t)};a.off=function(e,n){u(a,e,n)}},contain:function(){var a=this;a.type="cons";a._childs=[];a.x=0;a.y=0;a.rotate=0;a.alpha=1;a.addChild=function(e){a._childs.push(e);e._daddy=a};a.addChild2=function(e){a._childs.unshift(e);e._daddy=a};a.removeChild=function(e){var n=a._childs;for(var i=0;i<n.length;i++){if(n[i]==e){e._daddy=undefined;n.splice(i,1);return}}};a.on=function(e,n,i,t){h(a,e,n,i,t)};a.off=function(e,n){u(a,e,n)}},openRepick:function(e,r){if(P._time!=undefined)return;var f=P.canvas;var o=P.ctx;if(e==undefined)P.opening=true;else P.opening=e;P.noClear=r;var s=1e3/T;var c=Date.now();var d;var l=1;h();P._showPage=u;P.onFrameHandle=function(){if(P._time==undefined)P._time=requestAnimationFrame(h)};function h(){d=Date.now();if(d-c<s*l){if(P.opening)P._time=requestAnimationFrame(h);return}y=(d-c)/s/l*T;l++;if(l>=T){l=1;c=d}if(P.opening)P._time=requestAnimationFrame(h);else P._time=undefined;if(w!=undefined){for(var e=0;e<w.length;e++){w[e]()}}if(I!=undefined&&I.length!=0){for(var n=0;n<I.length;n++){var i=I[n];var t=false;var a=i.sm.i++;for(var e in i.obj){i.mc[e]=i.sm[e][a];if(a==i.sm[e].length-1){t=true}}if(t){if(i.loop==false){I.splice(n,1);if(i.callBack!=undefined)i.callBack();n--}else{if(i.loop<0)i.loop++;i.sm.i=0}}}}if(r==undefined)o.clearRect(0,0,f.width,f.height);u(P.stage);if(_!=undefined){for(var e=0;e<_.length;e++){_[e]()}}}function u(e){o.save();m(e);o.translate(e.x,e.y);if(e.rotate==undefined)e.rotate=0;var n=e.rotate*Math.PI/180;o.globalAlpha*=e.alpha;o.rotate(n);if(e.scaleX!=undefined||e.scaleY!=undefined){if(e.scaleX==undefined)var i=1,t=e.scaleY;else if(e.scaleY==undefined)var t=1,i=e.scaleX;else i=e.scaleX,t=e.scaleY;o.scale(i,t)}if(e.transform!=undefined){var i=e.transform;o.transform(i[0],i[1],i[2],i[3],i[4],i[5])}for(var a=0;a<e._childs.length;a++){if(e._childs[a].type=="img"){v(e._childs[a])}else if(e._childs[a].type=="cons"){u(e._childs[a])}else if(e._childs[a].type=="txt"){p(e._childs[a])}else if(e._childs[a].type=="shape"){g(e._childs[a])}}x(e);o.restore();if(o==P.canvas){o.draw()}}function v(e){o.save();m(e);var n=e.img.width;var i=e.img.height;var t=e.regX;var a=e.regY;if(e.rotate==undefined)e.rotate=0;var r=e.rotate*Math.PI/180;o.globalAlpha*=e.alpha;o.scale(e.scaleX,e.scaleY);o.translate(e.x,e.y);o.rotate(r);if(e.transform!=undefined){var f=e.transform;o.transform(f[0],f[1],f[2],f[3],f[4],f[5])}o.imageSmoothingEnabled=true;o.drawImage(e.img,0,0,e.img.width,e.img.height,-t,-a,n,i);x(e);o.restore()}function p(e){e.text=e.text.toString();o.save();m(e);o.textAlign=e.align;o.font=e.size;o.fillStyle=e.color;o.globalAlpha*=e.alpha;o.translate(e.x,e.y);o.scale(e.scaleX,e.scaleY);if(e.rotate==undefined)e.rotate=0;var n=e.rotate*Math.PI/180;o.rotate(n);var i=e.text;var t=i.split("\n");if(e.lineHeight==undefined)e.lineHeight=0;for(var a=0;a<t.length;a++){var r=t[a];var f=false;if(e.maxWith!=undefined){if(e.maxHeight!=undefined&&a==e.maxHeight-1){if(t.length>e.maxHeight){r=S(r,e.maxWith-3,-1)}else{r=S(r,e.maxWith-3,0)}f=true}else{r=S(r,e.maxWith,1);var s=t[a].replace(r,"");if(s!="")t.splice(a+1,0,s)}o.fillText(r,0,e.lineHeight*a,e.maxWidth)}else{if(a==0)e.width=o.measureText(r).width;else if(e.width<o.measureText(r).width)e.width=o.measureText(r).width;o.fillText(r,0,e.lineHeight*a)}if(f)break}o.restore();x(e)}function g(e){o.save();m(e);o.fillStyle=e.color;o.strokeStyle=e.color;o.globalAlpha*=e.alpha;o.translate(e.x,e.y);o.scale(e.scaleX,e.scaleY);if(e.rotate==undefined)e.rotate=0;var n=e.rotate*Math.PI/180;o.rotate(n);o.beginPath();if(e.transform!=undefined){var i=e.transform;o.transform(i[0],i[1],i[2],i[3],i[4],i[5])}if(e.typeSp==1){o.fillRect(0,0,e.width,e.height);x(e)}else if(e.typeSp==2){o.scale(e.scx,e.scy);o.moveTo(e.r,e.r);o.arc(0,0,e.r,0,2*Math.PI);x(e);o.fill()}else if(e.typeSp==3){o.scale(e.scx,e.scy);t(o,e);x(e);o.fill()}else if(e.typeSp==4){o.scale(e.scx,e.scy);a(o,e);x(e);o.fill()}else if(e.typeSp==-1){o.scale(e.scx,e.scy);e.drawOther();x(e)}o.restore()}function m(e){if(e.mask!=undefined){var n=e.mask;o.beginPath();if(n.typeSp==1){o.rect(n.x,n.y,n.width,n.height)}else if(n.typeSp==2){o.scale(n.scx,n.scy);o.moveTo(n.x+n.r,n.y);o.arc(n.x,n.y,n.r,0,2*Math.PI);o.scale(1/n.scx,1/n.scy)}else if(n.typeSp==3){t(o,n)}else if(e.typeSp==4){a(o,e)}else if(e.typeSp==-1){e.drawOther()}o.clip()}}function x(e){if(e._eventType==undefined||e._event==undefined)return;else{var n=e._eventSX;o.save();if(e._eventType==1){o.beginPath();o.rect(n.x,n.y,n.width,n.height)}else if(e._eventType==2){if(n.scx==undefined)n.scx=1;if(n.scy==undefined)n.scy=1;o.beginPath();o.scale(n.scx,n.scy);o.moveTo(n.x+n.r,n.y);o.arc(n.x,n.y,n.r,0,2*Math.PI)}o.closePath();var i=o.isPointInPath(e._event.x,e._event.y);if(i){e._event.fun({x:e._event.x,y:e._event.y})}o.restore();e._event=undefined}}function t(e,n){e.beginPath();var i=n.x;var t=n.y;e.moveTo(i+n.width-n.r,t+n.height-n.r);e.arc(i+n.width-n.r,t+n.height-n.r,n.r,0,Math.PI/2);e.lineTo(i+n.r,t+n.height);e.arc(i+n.r,t+n.height-n.r,n.r,Math.PI/2,Math.PI);e.lineTo(i,t+n.r);e.arc(i+n.r,t+n.r,n.r,Math.PI,Math.PI*3/2);e.lineTo(i+n.width-n.r,t);e.arc(i+n.width-n.r,t+n.r,n.r,Math.PI*3/2,Math.PI*2);e.lineTo(i+n.width,t+n.height-n.r);e.closePath();e.stroke()}function a(e,n){e.beginPath();var i=n.x;var t=n.y;for(var a=0;a<n.points.length;a++){if(a==0)e.moveTo(i+n.points[a].x,t+n.points[a].y);else e.lineTo(i+n.points[a].x,t+n.points[a].y)}a=0;e.lineTo(i+n.points[a].x,t+n.points[a].y);e.closePath();e.stroke()}},removeTime:function(){if(P._time!=undefined){cancelAnimationFrame(P._time);P._time=undefined}},removeRepickFun:function(e){for(var n=0;n<P.repickFun.length;n++){if(e==P.repickFun[n]){P.repickFun.splice(n,1)}}},events:function(e,n){if(e.changedTouches.length==0&&e.touches.length==0)return;else if(e.changedTouches.length==0&&e.touches.length!=0)e.changedTouches=e.touches;let i={x:e.changedTouches[0].x,y:e.changedTouches[0].y};if(i.x==undefined&&e.changedTouches[0].pageX!=undefined){i.x=e.changedTouches[0].pageX;i.y=e.changedTouches[0].pageY}else if(i.x==undefined&&e.changedTouches[0].clientX!=undefined){i.x=e.changedTouches[0].clientX;i.y=e.changedTouches[0].clientY}let t=P.canvas.width/P.canvas.realWidth;let a=P.canvas.height/P.canvas.realHeight;var r=i.x*t;var f=i.y*a;for(var s=0;s<v.length;s++){if(v[s].type==e.type){v[s].mc._event={x:r,y:f,fun:v[s].fun}}}},tweenCreate:function(e,n,i,t,a,r,f){var s={};s.name=e;s.mc=n;s.obj=i;s.time=t;s.sm={};s.callBack=f;for(var o in i){var c=n[o];var d=i[o];var l=[];if(d.length!=undefined&&d.length!=0){var h=[];var u=[];var v=[];var p=0;for(var g=0;g<d.length;g++){if(g==0){h.push(d[g]-c);v.push(c)}else{h.push(d[g]-d[g-1]);v.push(d[g-1])}p+=Math.abs(h[g])}for(var g=0;g<h.length;g++){if(p==0){u.push(parseInt(t*T/(1e3*h.length)))}else{u.push(parseInt(Math.abs(h[g])*t*T/(1e3*p)))}for(var m=0;m<u[g];m++){if(p==0){l.push(c);continue}var x=(m+1)/u[g];if(a!=undefined&&a!=-1){y=a(x)*(d[g]-v[g])+v[g]}else{var y=x*(d[g]-v[g])+v[g]}l.push(y)}}}else{var w=parseInt(t*T/1e3);for(var m=0;m<w;m++){var x=(m+1)/w;if(a!=undefined&&a!=-1){y=a(x)*(d-c)+c}else{var y=x*(d-c)+c}l.push(y)}}s.sm[o]=l;s.sm.i=0}if(r==undefined||r==false)s.loop=false;else{if(r>1)s.loop=-r;else s.loop=r}I.push(s);return s.name},tweenRemove:function(e){for(var n=0;n<I.length;n++){if(I[n].name==e){I.splice(n,1);break}}},removeMc:function(){I=[];v=[];P.stage._childs=[];P.clearEnd=true;this.removeTime()}};P.getLineTxt=function(e,n,i,t){if(e==undefined||e=="")return"";e=e.toString();var a=e.split("\n");var r="";for(var f=0;f<a.length;f++){var s=a[f];s=c(s,n,i,t);if(f!=0)r+="\n"+s;else r+=s}return r};a()}})(wmGame);export default wmGame;